# 🔐 密码管理功能使用指南

## 功能概述

系统新增了两个密码管理功能：

1. **修改密码** - 所有用户可以修改自己的密码
2. **重置密码** - 管理员可以为任何用户重置密码

---

## 📝 一、修改密码（所有用户）

### 使用步骤

1. **登录系统**
   - 使用你的用户名和密码登录

2. **点击"修改密码"按钮**
   - 在页面右上角，用户名旁边有蓝色的"修改密码"按钮
   - 点击后会弹出修改密码对话框

3. **填写表单**
   - **旧密码**：输入你当前的密码
   - **新密码**：输入新密码（至少6个字符）
   - **确认新密码**：再次输入新密码

4. **确认修改**
   - 点击"确认修改"按钮
   - 如果成功，会提示"密码修改成功！"
   - 下次登录请使用新密码

### 常见问题

**Q: 为什么需要输入旧密码？**
A: 为了安全，防止别人使用你的电脑时随意修改你的密码

**Q: 忘记旧密码怎么办？**
A: 请联系管理员帮你重置密码

**Q: 新密码有什么要求？**
A: 至少6个字符，不能与旧密码相同

**Q: 修改密码后需要重新登录吗？**
A: 不需要，当前登录状态会保持。但下次登录需要使用新密码

---

## 👨‍💼 二、重置密码（仅管理员）

### 使用步骤

1. **使用管理员账号登录**
   - 用户名：`admin`
   - 密码：`admin123`（建议修改默认密码）

2. **打开管理员面板**
   - 登录后会自动显示"👨‍💼 管理员面板"

3. **选择要重置密码的用户**
   - 在下拉框中选择一个用户
   - 例如：`bushanshan (5条日志)`

4. **点击"重置密码"按钮**
   - 选择用户后，红色的"重置密码"按钮会变为可用
   - 点击后弹出重置密码对话框

5. **设置新密码**
   - **新密码**：为该用户设置新密码（至少6个字符）
   - **确认新密码**：再次输入新密码

6. **确认重置**
   - 点击"确认重置"按钮
   - 成功后会提示："已成功为用户 'xxx' 重置密码！"

7. **通知用户**
   - 重置完成后，请告知该用户新密码
   - 建议用户登录后立即修改密码

### 常见问题

**Q: 重置密码需要知道用户的旧密码吗？**
A: 不需要。管理员可以直接为用户设置新密码

**Q: 重置密码后用户会立即退出登录吗？**
A: 不会。如果用户正在使用系统，仍可继续使用。但下次登录需要用新密码

**Q: 可以重置管理员自己的密码吗？**
A: 可以，管理员可以使用"修改密码"功能。但不能通过重置功能重置自己的密码

**Q: 能批量重置多个用户的密码吗？**
A: 目前不支持批量重置，需要逐个用户操作

---

## 🔧 三、API接口说明（开发者）

### 1. 修改密码 API

**端点**: `POST /api/auth/change-password`

**请求体**:
```json
{
  "token": "用户的JWT token",
  "oldPassword": "旧密码",
  "newPassword": "新密码"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "密码修改成功"
}
```

**错误响应**:
```json
{
  "error": "旧密码错误"
}
```

**可能的错误**:
- `401` - 未提供认证令牌 / 无效的认证令牌
- `400` - 旧密码和新密码不能为空 / 新密码长度至少为6个字符 / 新密码不能与旧密码相同
- `401` - 旧密码错误
- `404` - 用户不存在
- `500` - 服务器错误

---

### 2. 重置密码 API（仅管理员）

**端点**: `POST /api/admin/reset-password`

**请求体**:
```json
{
  "token": "管理员的JWT token",
  "userId": 123,
  "newPassword": "新密码"
}
```

**成功响应**:
```json
{
  "success": true,
  "message": "已成功为用户 'username' 重置密码"
}
```

**错误响应**:
```json
{
  "error": "无管理员权限"
}
```

**可能的错误**:
- `401` - 未提供认证令牌 / 无效的认证令牌
- `403` - 无管理员权限
- `400` - 用户ID和新密码不能为空 / 新密码长度至少为6个字符
- `404` - 目标用户不存在
- `500` - 服务器错误

---

## 🛡️ 四、安全建议

### 对于所有用户：

1. **使用强密码**
   - 至少8个字符
   - 包含大小写字母、数字和特殊符号
   - 不要使用生日、姓名等容易猜到的密码

2. **定期更换密码**
   - 建议每3个月更换一次密码
   - 不要重复使用旧密码

3. **不要共享密码**
   - 不要告诉别人你的密码
   - 不要在公共电脑上保存密码

4. **安全退出**
   - 使用完系统后点击"退出登录"
   - 特别是在公共电脑上

### 对于管理员：

1. **立即修改默认密码**
   - 默认密码 `admin123` 应该立即修改为强密码

2. **谨慎重置用户密码**
   - 只在用户确认请求后才重置
   - 通过安全渠道告知新密码（如面对面、加密通讯）
   - 建议用户收到新密码后立即修改

3. **记录密码重置操作**
   - 建议记录何时、为谁重置了密码
   - 便于安全审计

4. **权限最小化原则**
   - 不要轻易将其他用户设置为管理员
   - 定期审查管理员列表

---

## 📞 五、获取帮助

如果遇到问题：

1. **用户**：联系系统管理员
2. **管理员**：
   - 查看服务器日志
   - 访问数据库直接修改密码（使用 password-tool.html）
   - 联系技术支持

---

## 🎉 总结

- ✅ 所有用户可以自己修改密码
- ✅ 管理员可以为任何用户重置密码
- ✅ 密码使用 bcrypt 加密存储，安全可靠
- ✅ 所有操作都需要身份验证
- ✅ 支持密码强度验证

**重要提醒**：密码是保护账号安全的第一道防线，请妥善保管！
